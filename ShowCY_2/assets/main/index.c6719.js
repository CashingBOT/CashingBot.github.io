window.__require=function e(t,r,i){function n(s,a){if(!r[s]){if(!t[s]){var c=s.split("/");if(c=c[c.length-1],!t[c]){var d="function"==typeof __require&&__require;if(!a&&d)return d(c,!0);if(o)return o(c,!0);throw new Error("Cannot find module '"+s+"'")}s=c}var u=r[s]={exports:{}};t[s][0].call(u.exports,function(e){return n(t[s][1][e]||e)},u,u.exports,e,t,r,i)}return r[s].exports}for(var o="function"==typeof __require&&__require,s=0;s<i.length;s++)n(i[s]);return n}({"bezier-assembler":[function(e,t,r){"use strict";cc._RF.push(t,"127a1Pl8H1Ah6HR7eXmaI7E","bezier-assembler"),Object.defineProperty(r,"__esModule",{value:!0});var i=e("./page-effect-assembler-base"),n=cc.gfx,o=new n.VertexFormat([{name:n.ATTR_POSITION,type:n.ATTR_TYPE_FLOAT32,num:2},{name:n.ATTR_UV0,type:n.ATTR_TYPE_FLOAT32,num:2},{name:n.ATTR_COLOR,type:n.ATTR_TYPE_UINT8,num:4,normalize:!0},{name:"a_isFront",type:n.ATTR_TYPE_FLOAT32,num:1}]),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.angle=0,t}return __extends(t,e),t.prototype.updateRenderData=function(e){if(e){var t=e.getPointCount();if(t<2)return;var r=e.node,i=r.height,n=r.width,o=-n*r.anchorX,s=-i*r.anchorY,a=this._getCtrlPosByAngle(n),c=a.startPos,d=a.endPos,u=a.ctrlPos1,l=a.ctrlPos2,h=[];h[0]=c;for(var p=0,f=0,_=0,y=this.floatsPerVert,b=this.renderData.vDatas[0],v=0,g=1;g<t;g++){var x=g===t-1,m=h[g-1],P=this._getBezierPos(g/(t-1),c,d,u,l),z=this._fixWidth(m,P,n,p,x),R=z.gapWidth;P=z.nextBezierPos,p+=R,h[g]=P,_=f+R/n,b[v=y*(g-1)*4]=o+m.x,b[v+1]=s+m.y,b[v+2]=f,b[v+3]=1,b[v+=y]=o+P.x,b[v+1]=s+P.y,b[v+2]=_,b[v+3]=1,b[v+=y]=o+m.x,b[v+1]=s+i+m.y,b[v+2]=f,b[v+3]=0,b[v+=y]=o+P.x,b[v+1]=s+i+P.y,b[v+2]=_,b[v+3]=0,f=_}this.updateColor(e,null),this.updateIsFront(e,5)}},t.prototype.init=function(t){e.prototype.init.call(this,t);var r=t.getPointCount()-1;this.verticesCount=4*r,this.indicesCount=6*r,this.floatsPerVert=6,this.initData()},t.prototype.getVfmt=function(){return o},t.prototype._getCtrlPosByAngle=function(e){var t=new cc.Vec2(0,0),r=null,i=null,n=null,o=this.angle*Math.PI/180*2/Math.PI;if(this.angle<=90){var s=e*(1-Math.pow(o,3)),a=e/4*(1-Math.pow(1-o,4));r=new cc.Vec2(s,a);var c=e*(1-.25*o),d=1*e/16*o,u=3*e/16*o;i=new cc.Vec2(c,d),n=new cc.Vec2(c,u)}else{o-=1,s=-e*(1-Math.pow(1-o,3)),a=e/4*(1-Math.pow(o,4)),r=new cc.Vec2(s,a);var l=3*e/4*(1-o),h=3*e/4*Math.pow(1-o,3);d=1*e/16*(1-o),u=3*e/16*(1-Math.pow(o,4)),i=new cc.Vec2(l,d),n=new cc.Vec2(h,u)}return{startPos:t,endPos:r,ctrlPos1:i,ctrlPos2:n}},t.prototype._fixWidth=function(e,t,r,i,n){var o=t.sub(e),s=o.mag(),a=i+s;if(n){s=r-i;var c=o.normalize();t=e.add(c.mul(s))}else a>=r&&(s-=1.1*(a-r),s=Math.max(0,s),c=o.normalize(),t=e.add(c.mul(s)));return{gapWidth:s,nextBezierPos:t}},t.prototype._getBezierPos=function(e,t,r,i,n){return t=t.mul(Math.pow(1-e,3)),i=i.mul(3*e*Math.pow(1-e,2)),n=n.mul(3*(1-e)*Math.pow(e,2)),r=r.mul(Math.pow(e,3)),t.add(i.add(n.add(r)))},t}(i.default);r.default=s,cc._RF.pop()},{"./page-effect-assembler-base":"page-effect-assembler-base"}],"bezier-render":[function(e,t,r){"use strict";cc._RF.push(t,"33e45xqc9pJ/agYa1E+jVYa","bezier-render"),Object.defineProperty(r,"__esModule",{value:!0});var i=e("./bezier-assembler"),n=cc._decorator,o=n.ccclass,s=n.property,a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.textureList=[],t.pointsCount=10,t._initedMaterial=!1,t}return __extends(t,e),t.prototype.onEnable=function(){e.prototype.onEnable.call(this),this.init()},t.prototype.init=function(){this._initedMaterial||this.updateMaterial(),this.setVertsDirty()},t.prototype._resetAssembler=function(){(this._assembler=new i.default).init(this)},t.prototype._updateMaterial=function(){var e=this.getMaterial(0);e&&(e.define("CC_USE_MODEL",1),2===this.textureList.length&&(e.setProperty("texture0",this.textureList[0]),e.setProperty("texture1",this.textureList[1])))},t.prototype.updateMaterial=function(){if(2===this.textureList.length)return this._updateMaterial(),void(this._initedMaterial=!0)},t.prototype.getPointCount=function(){return this.pointsCount},t.prototype.updateAngle=function(e){this._assembler&&(this._assembler.angle=e,this._assembler.updateRenderData(this))},__decorate([s({type:[cc.Texture2D],displayName:"\u7eb9\u7406"})],t.prototype,"textureList",void 0),__decorate([s({displayName:"\u6bcf\u6761\u8fb9\u4e0a\u7684\u9876\u70b9\u6570\u91cf"})],t.prototype,"pointsCount",void 0),__decorate([o],t)}(cc.RenderComponent);r.default=a,cc._RF.pop()},{"./bezier-assembler":"bezier-assembler"}],"page-effect-assembler-base":[function(e,t,r){"use strict";cc._RF.push(t,"ad298hcoFFPjqeo9GC0tsCB","page-effect-assembler-base"),Object.defineProperty(r,"__esModule",{value:!0});var i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.verticesCount=4,t.indicesCount=6,t.floatsPerVert=5,t.colorOffset=4,t.renderData=null,t}return __extends(t,e),Object.defineProperty(t.prototype,"verticesFloats",{get:function(){return this.verticesCount*this.floatsPerVert},enumerable:!1,configurable:!0}),t.prototype.getBuffer=function(){return cc.renderer._handle.getBuffer("mesh",this.getVfmt())},t.prototype.getVfmt=function(){return null},t.prototype.updateColor=function(e,t){var r=this.renderData.uintVDatas[0];if(r){t=null!=t?t:e.node.color._val;for(var i=this.floatsPerVert,n=this.colorOffset,o=r.length;n<o;n+=i)r[n]=t}},t.prototype.updateIsFront=function(e,t){for(var r=this.renderData.vDatas[0],i=0,n=this.floatsPerVert,o=0,s=this.verticesCount;o<s;++o){i=o*n;var a=o%2==0,c=(a?r[i]:r[i-n])<(a?r[i+n]:r[i])?1:0;r[i+t]=c}},t.prototype.initData=function(){this.renderData=new cc.RenderData,this.renderData.init(this);var e=this.renderData;e.createFlexData(0,this.verticesCount,this.indicesCount,this.getVfmt());for(var t=e.iDatas[0],r=t.length/6,i=0,n=0;i<r;i++){var o=4*i;t[n++]=o,t[n++]=o+1,t[n++]=o+2,t[n++]=o+1,t[n++]=o+3,t[n++]=o+2}},t.prototype.fillBuffers=function(){var e=this.renderData,t=e.vDatas[0],r=e.iDatas[0],i=this.getBuffer(),n=i.request(this.verticesCount,this.indicesCount),o=n.byteOffset>>2,s=i._vData;t.length+o>s.length?s.set(t.subarray(0,s.length-o),o):s.set(t,o);for(var a=i._iData,c=n.indiceOffset,d=n.vertexOffset,u=0,l=r.length;u<l;u++)a[c++]=d+r[u]},t}(cc.Assembler);r.default=i,cc._RF.pop()},{}],page:[function(e,t,r){"use strict";cc._RF.push(t,"8f20ffFFn1GyZqIezO01S4H","page"),Object.defineProperty(r,"__esModule",{value:!0});var i=e("./bezier-render"),n=cc._decorator,o=n.ccclass,s=n.property,a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.bezierRender=[],t.videoPlayer=null,t.audioSource=null,t.book=null,t.btnPlay=null,t._angle=0,t.idx=0,t.canFlip=!1,t.isForward=!0,t}return __extends(t,e),t.prototype.start=function(){var e=this;this.bezierRender[0].node.zIndex=30,this.bezierRender[1].node.zIndex=20,this.bezierRender[2].node.zIndex=10,this.bezierRender[3].node.zIndex=0,this.videoPlayer.node.on("completed",function(){return e.node.getComponent(cc.AudioSource).resume()},this),this.book.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this)},t.prototype.onDestroy=function(){var e=this;this.videoPlayer.node.off("completed",function(){return e.node.getComponent(cc.AudioSource).resume()},this),this.book.off(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this)},t.prototype.update=function(e){var t=this;if(this.canFlip){if(this.isForward)this._angle+=180*e,this._angle>180&&(this._angle=180,this.idx++,this.canFlip=!1,this.bezierRender[this.idx]||cc.tween(this.videoPlayer.node).to(.3,{scale:1}).call(function(){t.node.getComponent(cc.AudioSource).pause(),t.btnPlay.active=!0}).start());else if(this._angle-=180*e,this._angle<0)switch(this._angle=0,this.canFlip=!1,this.idx){case 0:break;case 1:this.bezierRender[this.idx].node.zIndex-=100;break;case 2:this.bezierRender[this.idx].node.zIndex-=200;break;case 3:this.bezierRender[this.idx].node.zIndex-=300}this.canFlip&&this.bezierRender[this.idx].updateAngle(this._angle)}},t.prototype.onClickForward=function(){if(!this.canFlip&&this.bezierRender[this.idx]){switch(this.isForward=!0,this.idx){case 0:break;case 1:this.bezierRender[this.idx].node.zIndex+=100;break;case 2:this.bezierRender[this.idx].node.zIndex+=200;break;case 3:this.bezierRender[this.idx].node.zIndex+=300}this.canFlip=!0,this._angle=0,this.audioSource.play()}},t.prototype.onClickBack=function(){this.bezierRender[this.idx]||(this.btnPlay.active=!1),this.canFlip||(this.idx--,this.idx<0&&(this.idx=0),this.bezierRender[this.idx]&&(this.isForward=!1,this.canFlip=!0,this._angle=180,this.audioSource.play(),this.idx===this.bezierRender.length-1&&(this.node.getComponent(cc.AudioSource).resume(),this.videoPlayer.stop(),cc.tween(this.videoPlayer.node).to(.3,{scale:0}).start())))},t.prototype.onTouchMove=function(e){this.book.x+=e.getDelta().x,this.book.y+=e.getDelta().y},__decorate([s({type:[i.default],displayName:"\u8d1d\u585e\u5c14\u66f2\u7ebf"})],t.prototype,"bezierRender",void 0),__decorate([s(cc.VideoPlayer)],t.prototype,"videoPlayer",void 0),__decorate([s(cc.AudioSource)],t.prototype,"audioSource",void 0),__decorate([s(cc.Node)],t.prototype,"book",void 0),__decorate([s(cc.Node)],t.prototype,"btnPlay",void 0),__decorate([o],t)}(cc.Component);r.default=a,cc._RF.pop()},{"./bezier-render":"bezier-render"}],use_reversed_rotateBy:[function(e,t){"use strict";cc._RF.push(t,"8bd5d47FIpCTpx4blqJv1ep","use_reversed_rotateBy"),cc.RotateBy._reverse=!0,cc._RF.pop()},{}]},{},["use_reversed_rotateBy","bezier-assembler","bezier-render","page-effect-assembler-base","page"]);