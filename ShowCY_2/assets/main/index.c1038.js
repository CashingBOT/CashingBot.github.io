window.__require=function e(t,i,r){function n(s,a){if(!i[s]){if(!t[s]){var c=s.split("/");if(c=c[c.length-1],!t[c]){var p="function"==typeof __require&&__require;if(!a&&p)return p(c,!0);if(o)return o(c,!0);throw new Error("Cannot find module '"+s+"'")}s=c}var u=i[s]={exports:{}};t[s][0].call(u.exports,function(e){return n(t[s][1][e]||e)},u,u.exports,e,t,i,r)}return i[s].exports}for(var o="function"==typeof __require&&__require,s=0;s<r.length;s++)n(r[s]);return n}({"bezier-assembler":[function(e,t,i){"use strict";cc._RF.push(t,"127a1Pl8H1Ah6HR7eXmaI7E","bezier-assembler"),Object.defineProperty(i,"__esModule",{value:!0});var r=e("./page-effect-assembler-base"),n=cc.gfx,o=new n.VertexFormat([{name:n.ATTR_POSITION,type:n.ATTR_TYPE_FLOAT32,num:2},{name:n.ATTR_UV0,type:n.ATTR_TYPE_FLOAT32,num:2},{name:n.ATTR_COLOR,type:n.ATTR_TYPE_UINT8,num:4,normalize:!0},{name:"a_isFront",type:n.ATTR_TYPE_FLOAT32,num:1}]),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.angle=0,t}return __extends(t,e),t.prototype.updateRenderData=function(e){if(e){var t=e.getPointCount();if(t<2)return;var i=e.node,r=i.height,n=i.width,o=-n*i.anchorX,s=-r*i.anchorY,a=this._getCtrlPosByAngle(n),c=a.startPos,p=a.endPos,u=a.ctrlPos1,d=a.ctrlPos2,l=[];l[0]=c;for(var h=0,f=0,_=0,y=this.floatsPerVert,v=this.renderData.vDatas[0],m=0,b=1;b<t;b++){var g=b===t-1,P=l[b-1],x=this._getBezierPos(b/(t-1),c,p,u,d),w=this._fixWidth(P,x,n,h,g),T=w.gapWidth;x=w.nextBezierPos,h+=T,l[b]=x,_=f+T/n,v[m=y*(b-1)*4]=o+P.x,v[m+1]=s+P.y,v[m+2]=f,v[m+3]=1,v[m+=y]=o+x.x,v[m+1]=s+x.y,v[m+2]=_,v[m+3]=1,v[m+=y]=o+P.x,v[m+1]=s+r+P.y,v[m+2]=f,v[m+3]=0,v[m+=y]=o+x.x,v[m+1]=s+r+x.y,v[m+2]=_,v[m+3]=0,f=_}this.updateColor(e,null),this.updateIsFront(e,5)}},t.prototype.init=function(t){e.prototype.init.call(this,t);var i=t.getPointCount()-1;this.verticesCount=4*i,this.indicesCount=6*i,this.floatsPerVert=6,this.initData()},t.prototype.getVfmt=function(){return o},t.prototype._getCtrlPosByAngle=function(e){var t=new cc.Vec2(0,0),i=null,r=null,n=null,o=this.angle*Math.PI/180*2/Math.PI;if(this.angle<=90){var s=e*(1-Math.pow(o,3)),a=e/4*(1-Math.pow(1-o,4));i=new cc.Vec2(s,a);var c=e*(1-.25*o),p=1*e/16*o,u=3*e/16*o;r=new cc.Vec2(c,p),n=new cc.Vec2(c,u)}else{o-=1,s=-e*(1-Math.pow(1-o,3)),a=e/4*(1-Math.pow(o,4)),i=new cc.Vec2(s,a);var d=3*e/4*(1-o),l=3*e/4*Math.pow(1-o,3);p=1*e/16*(1-o),u=3*e/16*(1-Math.pow(o,4)),r=new cc.Vec2(d,p),n=new cc.Vec2(l,u)}return{startPos:t,endPos:i,ctrlPos1:r,ctrlPos2:n}},t.prototype._fixWidth=function(e,t,i,r,n){var o=t.sub(e),s=o.mag(),a=r+s;if(n){s=i-r;var c=o.normalize();t=e.add(c.mul(s))}else a>=i&&(s-=1.1*(a-i),s=Math.max(0,s),c=o.normalize(),t=e.add(c.mul(s)));return{gapWidth:s,nextBezierPos:t}},t.prototype._getBezierPos=function(e,t,i,r,n){return t=t.mul(Math.pow(1-e,3)),r=r.mul(3*e*Math.pow(1-e,2)),n=n.mul(3*(1-e)*Math.pow(e,2)),i=i.mul(Math.pow(e,3)),t.add(r.add(n.add(i)))},t}(r.default);i.default=s,cc._RF.pop()},{"./page-effect-assembler-base":"page-effect-assembler-base"}],"bezier-render":[function(e,t,i){"use strict";cc._RF.push(t,"33e45xqc9pJ/agYa1E+jVYa","bezier-render"),Object.defineProperty(i,"__esModule",{value:!0});var r=e("./bezier-assembler"),n=cc._decorator,o=n.ccclass,s=n.property,a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.textureList=[],t.pointsCount=10,t._initedMaterial=!1,t}return __extends(t,e),t.prototype.onEnable=function(){e.prototype.onEnable.call(this),this.init()},t.prototype.init=function(){this._initedMaterial||this.updateMaterial(),this.setVertsDirty()},t.prototype._resetAssembler=function(){(this._assembler=new r.default).init(this)},t.prototype._updateMaterial=function(){var e=this.getMaterial(0);e&&(e.define("CC_USE_MODEL",1),2===this.textureList.length&&(e.setProperty("texture0",this.textureList[0]),e.setProperty("texture1",this.textureList[1])))},t.prototype.updateMaterial=function(){if(2===this.textureList.length)return this._updateMaterial(),void(this._initedMaterial=!0)},t.prototype.getPointCount=function(){return this.pointsCount},t.prototype.updateAngle=function(e){this._assembler&&(this._assembler.angle=e,this._assembler.updateRenderData(this))},__decorate([s({type:[cc.Texture2D],displayName:"\u7eb9\u7406"})],t.prototype,"textureList",void 0),__decorate([s({displayName:"\u6bcf\u6761\u8fb9\u4e0a\u7684\u9876\u70b9\u6570\u91cf"})],t.prototype,"pointsCount",void 0),__decorate([o],t)}(cc.RenderComponent);i.default=a,cc._RF.pop()},{"./bezier-assembler":"bezier-assembler"}],"page-effect-assembler-base":[function(e,t,i){"use strict";cc._RF.push(t,"ad298hcoFFPjqeo9GC0tsCB","page-effect-assembler-base"),Object.defineProperty(i,"__esModule",{value:!0});var r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.verticesCount=4,t.indicesCount=6,t.floatsPerVert=5,t.colorOffset=4,t.renderData=null,t}return __extends(t,e),Object.defineProperty(t.prototype,"verticesFloats",{get:function(){return this.verticesCount*this.floatsPerVert},enumerable:!1,configurable:!0}),t.prototype.getBuffer=function(){return cc.renderer._handle.getBuffer("mesh",this.getVfmt())},t.prototype.getVfmt=function(){return null},t.prototype.updateColor=function(e,t){var i=this.renderData.uintVDatas[0];if(i){t=null!=t?t:e.node.color._val;for(var r=this.floatsPerVert,n=this.colorOffset,o=i.length;n<o;n+=r)i[n]=t}},t.prototype.updateIsFront=function(e,t){for(var i=this.renderData.vDatas[0],r=0,n=this.floatsPerVert,o=0,s=this.verticesCount;o<s;++o){r=o*n;var a=o%2==0,c=(a?i[r]:i[r-n])<(a?i[r+n]:i[r])?1:0;i[r+t]=c}},t.prototype.initData=function(){this.renderData=new cc.RenderData,this.renderData.init(this);var e=this.renderData;e.createFlexData(0,this.verticesCount,this.indicesCount,this.getVfmt());for(var t=e.iDatas[0],i=t.length/6,r=0,n=0;r<i;r++){var o=4*r;t[n++]=o,t[n++]=o+1,t[n++]=o+2,t[n++]=o+1,t[n++]=o+3,t[n++]=o+2}},t.prototype.fillBuffers=function(){var e=this.renderData,t=e.vDatas[0],i=e.iDatas[0],r=this.getBuffer(),n=r.request(this.verticesCount,this.indicesCount),o=n.byteOffset>>2,s=r._vData;t.length+o>s.length?s.set(t.subarray(0,s.length-o),o):s.set(t,o);for(var a=r._iData,c=n.indiceOffset,p=n.vertexOffset,u=0,d=i.length;u<d;u++)a[c++]=p+i[u]},t}(cc.Assembler);i.default=r,cc._RF.pop()},{}],page:[function(e,t,i){"use strict";cc._RF.push(t,"8f20ffFFn1GyZqIezO01S4H","page"),Object.defineProperty(i,"__esModule",{value:!0});var r=e("./bezier-render"),n=cc._decorator,o=n.ccclass,s=n.property,a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.bezierRender=[],t.videoPlayer=null,t.audioSource=null,t.book=null,t._angle=0,t.idx=0,t.canFlip=!1,t.isForward=!0,t}return __extends(t,e),t.prototype.start=function(){var e=this;this.bezierRender[0].node.zIndex=30,this.bezierRender[1].node.zIndex=20,this.bezierRender[2].node.zIndex=10,this.bezierRender[3].node.zIndex=0,this.videoPlayer.node.on("completed",function(){return e.node.getComponent(cc.AudioSource).resume()},this),this.book.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this)},t.prototype.onDestroy=function(){var e=this;this.videoPlayer.node.off("completed",function(){return e.node.getComponent(cc.AudioSource).resume()},this),this.book.off(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this)},t.prototype.update=function(e){var t=this;if(this.canFlip){if(this.isForward)this._angle+=180*e,this._angle>180&&(this._angle=180,this.idx++,this.canFlip=!1,this.bezierRender[this.idx]||cc.tween(this.videoPlayer.node).to(.3,{scale:1}).call(function(){t.node.getComponent(cc.AudioSource).pause(),t.videoPlayer.play()}).start());else if(this._angle-=180*e,this._angle<0)switch(this._angle=0,this.canFlip=!1,this.idx){case 0:break;case 1:this.bezierRender[this.idx].node.zIndex-=100;break;case 2:this.bezierRender[this.idx].node.zIndex-=200;break;case 3:this.bezierRender[this.idx].node.zIndex-=300}this.canFlip&&this.bezierRender[this.idx].updateAngle(this._angle)}},t.prototype.onClickForward=function(){if(!this.canFlip&&this.bezierRender[this.idx]){switch(this.isForward=!0,this.idx){case 0:break;case 1:this.bezierRender[this.idx].node.zIndex+=100;break;case 2:this.bezierRender[this.idx].node.zIndex+=200;break;case 3:this.bezierRender[this.idx].node.zIndex+=300}this.canFlip=!0,this._angle=0,this.audioSource.play()}},t.prototype.onClickBack=function(){this.canFlip||(this.idx--,this.idx<0&&(this.idx=0),this.bezierRender[this.idx]&&(this.isForward=!1,this.canFlip=!0,this._angle=180,this.audioSource.play(),this.idx===this.bezierRender.length-1&&(this.node.getComponent(cc.AudioSource).resume(),this.videoPlayer.stop(),cc.tween(this.videoPlayer.node).to(.3,{scale:0}).start())))},t.prototype.onTouchMove=function(e){this.book.x+=e.getDelta().x,this.book.y+=e.getDelta().y},__decorate([s({type:[r.default],displayName:"\u8d1d\u585e\u5c14\u66f2\u7ebf"})],t.prototype,"bezierRender",void 0),__decorate([s(cc.VideoPlayer)],t.prototype,"videoPlayer",void 0),__decorate([s(cc.AudioSource)],t.prototype,"audioSource",void 0),__decorate([s(cc.Node)],t.prototype,"book",void 0),__decorate([o],t)}(cc.Component);i.default=a,cc._RF.pop()},{"./bezier-render":"bezier-render"}],use_reversed_rotateBy:[function(e,t){"use strict";cc._RF.push(t,"8bd5d47FIpCTpx4blqJv1ep","use_reversed_rotateBy"),cc.RotateBy._reverse=!0,cc._RF.pop()},{}],"verlet-assembler":[function(e,t,i){"use strict";cc._RF.push(t,"1836aBqBwNJS4Bqqs+WHwuq","verlet-assembler"),Object.defineProperty(i,"__esModule",{value:!0});var r=e("./page-effect-assembler-base"),n=cc.gfx,o=new n.VertexFormat([{name:n.ATTR_POSITION,type:n.ATTR_TYPE_FLOAT32,num:2},{name:n.ATTR_UV0,type:n.ATTR_TYPE_FLOAT32,num:2},{name:n.ATTR_COLOR,type:n.ATTR_TYPE_UINT8,num:4,normalize:!0},{name:"a_isFront",type:n.ATTR_TYPE_FLOAT32,num:1}]),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.init=function(t){e.prototype.init.call(this,t);var i=t.pointsCount-1;this.verticesCount=4*i,this.indicesCount=6*i,this.floatsPerVert=6,this.initData()},t.prototype.getVfmt=function(){return o},t.prototype.updateRenderData=function(e){if(e){var t=e.getPointList(),i=t.length;if(i<2)return;for(var r=e.node,n=r.height,o=-r.width*r.anchorX,s=-n*r.anchorY,a=1/(i-1),c=0,p=0,u=this.floatsPerVert,d=this.renderData.vDatas[0],l=0,h=1;h<i;h++){var f=t[h-1],_=t[h];p=c+a,d[l=u*(h-1)*4]=o+f.x,d[l+1]=s+f.y,d[l+2]=c,d[l+3]=1,d[l+=u]=o+_.x,d[l+1]=s+_.y,d[l+2]=p,d[l+3]=1,d[l+=u]=o+f.x,d[l+1]=s+n+f.y,d[l+2]=c,d[l+3]=0,d[l+=u]=o+_.x,d[l+1]=s+n+_.y,d[l+2]=p,d[l+3]=0,c=p}this.updateColor(e,null),this.updateIsFront(e,5)}},t}(r.default);i.default=s,cc._RF.pop()},{"./page-effect-assembler-base":"page-effect-assembler-base"}],"verlet-render":[function(e,t,i){"use strict";cc._RF.push(t,"50dbcjXYhpDxpAmkQwp0/H6","verlet-render"),Object.defineProperty(i,"__esModule",{value:!0});var r=e("./verlet-assembler"),n=cc._decorator,o=n.ccclass,s=n.property,a=function(e,t){this.oldPos=this.newPos=cc.v2(e,t)},c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.textureList=[],t.pointsCount=30,t.constraintTimes=100,t.damping=.1,t.gravity=0,t._initedMaterial=!1,t._pointList=[],t._angle=0,t}return __extends(t,e),t.prototype.onEnable=function(){e.prototype.onEnable.call(this),this.initPointList(),this.draw()},t.prototype._resetAssembler=function(){(this._assembler=new r.default).init(this)},t.prototype._updateMaterial=function(){var e=this.getMaterial(0);e&&(e.define("CC_USE_MODEL",1),2===this.textureList.length&&(e.setProperty("texture0",this.textureList[0]),e.setProperty("texture1",this.textureList[1])))},t.prototype.updateMaterial=function(){if(2===this.textureList.length)return this._updateMaterial(),void(this._initedMaterial=!0)},t.prototype.updateAngle=function(e){this._angle=e},t.prototype.getPointList=function(){for(var e=[],t=0,i=this._pointList;t<i.length;t++){var r=i[t];e.push(new cc.Vec2(r.newPos.x,r.newPos.y))}return e},t.prototype.initPointList=function(){for(var e=0;e<this.pointsCount;++e){var t=e/(this.pointsCount-1)*this.node.width;this._pointList.push(new a(t,0))}},t.prototype.update=function(){this.simulate(),this.applyConstraint(),this.draw()},t.prototype.simulate=function(){for(var e=cc.v2(0,this.gravity),t=this.pointsCount-1;t>=1;t--){var i=this._pointList[t],r=i.newPos.sub(i.oldPos).mul(this.damping);i.newPos.y<=0&&(e.y=Math.max(0,e.y)),i.oldPos=i.newPos,i.newPos=i.newPos.add(r),i.newPos=i.newPos.add(e)}},t.prototype._updateEndPos=function(e){this._pointList[this.pointsCount-1].newPos=new cc.Vec2(e.x,e.y)},t.prototype._getEndPos=function(){var e=new cc.Vec2(0,0),t=this.node.width,i=this._angle*Math.PI/180*2/Math.PI;if(this._angle<=90){var r=t*(1-Math.pow(i,3)),n=1*t/4*(1-Math.pow(1-i,4));e=new cc.Vec2(r,n)}else i-=1,r=-t*(1-Math.pow(1-i,3)),n=1*t/4*(1-Math.pow(i,4)),e=new cc.Vec2(r,n);return e},t.prototype.applyConstraint=function(){for(var e=this.node.width/(this.pointsCount-1),t=this._getEndPos(),i=0;i<this.constraintTimes;i++){this._updateEndPos(t);for(var r=this.pointsCount-1;r>=1;r--){var n=this._pointList[r-1],o=this._pointList[r],s=o.newPos.sub(n.newPos),a=s.mag(),c=null;if(a<e)c=s.normalize().negate();else{if(!(a>e))continue;c=s.normalize()}var p=Math.abs(a-e);if(1==r){var u=c.mul(p);o.newPos.subSelf(u)}else{var d=c.mul(.5*p);n.newPos.addSelf(d),o.newPos.subSelf(d)}}}},t.prototype.draw=function(){this._initedMaterial||this.updateMaterial(),this.setVertsDirty()},__decorate([s({type:[cc.Texture2D],displayName:"\u7eb9\u7406"})],t.prototype,"textureList",void 0),__decorate([s({displayName:"\u6bcf\u6761\u8fb9\u4e0a\u7684\u9876\u70b9\u6570\u91cf"})],t.prototype,"pointsCount",void 0),__decorate([s({displayName:"\u7ea0\u6b63\u6b21\u6570"})],t.prototype,"constraintTimes",void 0),__decorate([s({displayName:"\u901f\u5ea6\u8870\u51cf\u7cfb\u6570"})],t.prototype,"damping",void 0),__decorate([s({displayName:"\u91cd\u529b"})],t.prototype,"gravity",void 0),__decorate([o],t)}(cc.RenderComponent);i.default=c,cc._RF.pop()},{"./verlet-assembler":"verlet-assembler"}]},{},["use_reversed_rotateBy","bezier-assembler","bezier-render","page-effect-assembler-base","page","verlet-assembler","verlet-render"]);